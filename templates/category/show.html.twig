{% extends 'base.html.twig' %}

{% block title %}{{ category.name }} - Productos{% endblock %}

{% block body %}
<!-- Hero Section -->
<div class="bg-primary text-white py-4">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb mb-2">
                        <li class="breadcrumb-item">
                            <a href="{{ path('home') }}" class="text-white-50">
                                <i class="fas fa-home"></i> Inicio
                            </a>
                        </li>
                        <li class="breadcrumb-item active text-white" aria-current="page">
                            {{ category.name }}
                        </li>
                    </ol>
                </nav>
                <h1 class="h2 mb-1">{{ category.name }}</h1>
                {% if category.description %}
                    <p class="lead mb-0 opacity-75">{{ category.description }}</p>
                {% endif %}
            </div>
            <div class="col-md-4 text-md-end">
                <span class="badge bg-white text-primary px-3 py-2">
                    {{ products|length }} producto{{ products|length != 1 ? 's' : '' }}
                </span>
            </div>
        </div>
    </div>
</div>

<div class="container my-5">
    {% if products|length > 0 %}
        <!-- Filters and Sorting -->
        <div class="row mb-4">
            <div class="col-lg-3">
                <!-- Filters Card -->
                <div class="card shadow-sm sticky-top" style="top: 20px;">
                    <div class="card-header bg-light">
                        <h5 class="mb-0">
                            <i class="fas fa-filter me-2"></i>Filtros
                        </h5>
                    </div>
                    <div class="card-body">
                        <!-- Price Range -->
                        <div class="mb-4">
                            <h6 class="fw-semibold">Rango de Precio</h6>
                            <div class="row g-2">
                                <div class="col-6">
                                    <input type="number" class="form-control form-control-sm" placeholder="Mín" id="price-min">
                                </div>
                                <div class="col-6">
                                    <input type="number" class="form-control form-control-sm" placeholder="Máx" id="price-max">
                                </div>
                            </div>
                        </div>
                        
                        <!-- Availability -->
                        <div class="mb-4">
                            <h6 class="fw-semibold">Disponibilidad</h6>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="in-stock" checked>
                                <label class="form-check-label" for="in-stock">
                                    En stock
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="out-of-stock">
                                <label class="form-check-label" for="out-of-stock">
                                    Sin stock
                                </label>
                            </div>
                        </div>
                        
                        <!-- Rating -->
                        <div class="mb-4">
                            <h6 class="fw-semibold">Valoración</h6>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="rating" id="rating-4">
                                <label class="form-check-label" for="rating-4">
                                    <span class="text-warning">★★★★☆</span> y más
                                </label>
                            </div>
                            <div class="form-check">
                                <input class="form-check-input" type="radio" name="rating" id="rating-3">
                                <label class="form-check-label" for="rating-3">
                                    <span class="text-warning">★★★☆☆</span> y más
                                </label>
                            </div>
                        </div>
                        
                        <button type="button" class="btn btn-primary w-100" id="apply-filters">
                            <i class="fas fa-check me-2"></i>Aplicar Filtros
                        </button>
                        <button type="button" class="btn btn-outline-secondary w-100 mt-2" id="clear-filters">
                            <i class="fas fa-times me-2"></i>Limpiar
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-9">
                <!-- Sorting and View Options -->
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <div class="d-flex align-items-center">
                        <span class="text-muted me-3">Ordenar por:</span>
                        <select class="form-select form-select-sm" style="width: auto;" id="sort-select">
                            <option value="name-asc">Nombre A-Z</option>
                            <option value="name-desc">Nombre Z-A</option>
                            <option value="price-asc">Precio: Menor a Mayor</option>
                            <option value="price-desc">Precio: Mayor a Menor</option>
                            <option value="newest">Más Nuevos</option>
                        </select>
                    </div>
                    
                    <div class="btn-group" role="group" aria-label="Vista">
                        <input type="radio" class="btn-check" name="view" id="grid-view" autocomplete="off" checked>
                        <label class="btn btn-outline-secondary btn-sm" for="grid-view">
                            <i class="fas fa-th"></i>
                        </label>
                        
                        <input type="radio" class="btn-check" name="view" id="list-view" autocomplete="off">
                        <label class="btn btn-outline-secondary btn-sm" for="list-view">
                            <i class="fas fa-list"></i>
                        </label>
                    </div>
                </div>

                <!-- Products Grid -->
                <div class="row" id="products-container">
                    {% for product in products %}
                        <div class="col-lg-4 col-md-6 mb-4" data-product-id="{{ product.id }}">
                            <div class="card h-100 shadow-sm product-card">
                                <!-- Product Image -->
                                <div class="card-img-container position-relative">
                                    {% if product.mainImage %}
                                        <img src="{{ product.mainImage }}" 
                                             class="card-img-top" 
                                             alt="{{ product.name }}"
                                             style="height: 250px; object-fit: cover;">
                                    {% else %}
                                        <div class="card-img-top bg-light d-flex align-items-center justify-content-center" 
                                             style="height: 250px;">
                                            <i class="fas fa-image fa-3x text-muted"></i>
                                        </div>
                                    {% endif %}
                                    
                                    <!-- Stock Badge -->
                                    {% if product.stock == 0 %}
                                        <span class="position-absolute top-0 start-0 badge bg-danger m-2">
                                            Sin Stock
                                        </span>
                                    {% elseif product.stock <= 5 %}
                                        <span class="position-absolute top-0 start-0 badge bg-warning text-dark m-2">
                                            Últimas {{ product.stock }} unidades
                                        </span>
                                    {% endif %}
                                    
                                    <!-- Quick Actions -->
                                    <div class="position-absolute top-0 end-0 m-2">
                                        <button class="btn btn-outline-light btn-sm rounded-circle" 
                                                data-bs-toggle="tooltip" 
                                                title="Agregar a favoritos">
                                            <i class="far fa-heart"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Product Info -->
                                <div class="card-body d-flex flex-column">
                                    <h5 class="card-title">
                                        <a href="{{ path('product_show', {'id': product.id}) }}" 
                                           class="text-decoration-none text-dark">
                                            {{ product.name }}
                                        </a>
                                    </h5>
                                    
                                    {% if product.description %}
                                        <p class="card-text text-muted small">
                                            {{ product.description|length > 100 ? product.description|slice(0, 100) ~ '...' : product.description }}
                                        </p>
                                    {% endif %}
                                    
                                    <!-- Rating -->
                                    <div class="mb-2">
                                        <div class="text-warning">
                                            ★★★★☆
                                        </div>
                                        <small class="text-muted">(4.5) 123 reseñas</small>
                                    </div>
                                    
                                    <!-- Price and Actions -->
                                    <div class="mt-auto">
                                        <div class="d-flex justify-content-between align-items-center mb-2">
                                            <div>
                                                <span class="h5 text-primary mb-0">${{ product.price|number_format(2) }}</span>
                                                {% if product.price > 100 %}
                                                    <div class="text-muted small">
                                                        <s>${{ (product.price * 1.2)|number_format(2) }}</s>
                                                        <span class="text-danger ms-1">-20%</span>
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                        
                                        <div class="btn-group w-100" role="group">
                                            {% if product.stock > 0 %}
                                                <button type="button" 
                                                        class="btn btn-primary flex-fill add-to-cart-btn"
                                                        data-product-id="{{ product.id }}">
                                                    <i class="fas fa-cart-plus me-1"></i>
                                                    <span class="d-none d-sm-inline">Agregar</span>
                                                </button>
                                            {% else %}
                                                <button type="button" class="btn btn-secondary flex-fill" disabled>
                                                    <i class="fas fa-times me-1"></i>Sin Stock
                                                </button>
                                            {% endif %}
                                            
                                            <a href="{{ path('product_show', {'id': product.id}) }}" 
                                               class="btn btn-outline-primary">
                                                <i class="fas fa-eye"></i>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
                
                <!-- Pagination -->
                <nav aria-label="Navegación de productos" class="mt-5">
                    <ul class="pagination justify-content-center">
                        <li class="page-item disabled">
                            <a class="page-link" href="#" tabindex="-1">
                                <i class="fas fa-chevron-left"></i>
                            </a>
                        </li>
                        <li class="page-item active">
                            <a class="page-link" href="#">1</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">2</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">3</a>
                        </li>
                        <li class="page-item">
                            <a class="page-link" href="#">
                                <i class="fas fa-chevron-right"></i>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    {% else %}
        <!-- Empty State -->
        <div class="text-center py-5">
            <i class="fas fa-box-open fa-5x text-muted mb-4"></i>
            <h3>No hay productos en esta categoría</h3>
            <p class="text-muted mb-4">Parece que no tenemos productos disponibles en "{{ category.name }}" en este momento.</p>
            <a href="{{ path('home') }}" class="btn btn-primary">
                <i class="fas fa-home me-2"></i>Volver al Inicio
            </a>
        </div>
    {% endif %}
</div>

<!-- Quick View Modal -->
<div class="modal fade" id="quickViewModal" tabindex="-1" aria-labelledby="quickViewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="quickViewModalLabel">Vista Rápida</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <!-- Content will be loaded dynamically -->
                <div class="text-center py-5">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block javascripts %}
{{ parent() }}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize tooltips
    var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
    var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
        return new bootstrap.Tooltip(tooltipTriggerEl);
    });
    
    // View toggle functionality
    const gridView = document.getElementById('grid-view');
    const listView = document.getElementById('list-view');
    const productsContainer = document.getElementById('products-container');
    
    listView.addEventListener('change', function() {
        if (this.checked) {
            productsContainer.className = 'row';
            const productCards = productsContainer.querySelectorAll('.col-lg-4');
            productCards.forEach(card => {
                card.className = 'col-12 mb-3';
                const cardElement = card.querySelector('.card');
                cardElement.className = 'card shadow-sm product-card';
                const cardBody = cardElement.querySelector('.card-body');
                cardBody.style.minHeight = 'auto';
            });
        }
    });
    
    gridView.addEventListener('change', function() {
        if (this.checked) {
            const productCards = productsContainer.querySelectorAll('.col-12');
            productCards.forEach(card => {
                card.className = 'col-lg-4 col-md-6 mb-4';
                const cardElement = card.querySelector('.card');
                cardElement.className = 'card h-100 shadow-sm product-card';
            });
        }
    });
    
    // Add to cart functionality
    document.querySelectorAll('.add-to-cart-btn').forEach(button => {
        button.addEventListener('click', function() {
            const productId = this.dataset.productId;
            // Add your cart functionality here
            
            // Visual feedback
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-check me-1"></i>Agregado';
            this.disabled = true;
            
            setTimeout(() => {
                this.innerHTML = originalText;
                this.disabled = false;
            }, 2000);
        });
    });
    
    // Sort functionality
    document.getElementById('sort-select').addEventListener('change', function() {
        const sortValue = this.value;
        // Add your sorting logic here
        console.log('Sorting by:', sortValue);
    });
    
    // Filter functionality
    document.getElementById('apply-filters').addEventListener('click', function() {
        // Add your filter logic here
        console.log('Applying filters...');
    });
    
    document.getElementById('clear-filters').addEventListener('click', function() {
        // Clear all filters
        document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
        document.querySelectorAll('input[type="radio"]').forEach(radio => radio.checked = false);
        document.getElementById('price-min').value = '';
        document.getElementById('price-max').value = '';
        document.getElementById('in-stock').checked = true;
    });
});
</script>
{% endblock %}